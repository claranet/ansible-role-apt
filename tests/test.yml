---

- name: APT manager
  hosts: localhost
  remote_user: ansible
  roles:
    - { role: ansible-role-apt, become: yes }
  vars:
    - apt_packages:
      # package from official repo
      - name: tree
      # specific pacakge version
      - name: vim=2:8.*
      # package with dependencies
      - name: python-pip
      # package from contrib repo
      - name: java-package
      # package from non-free repo
      - name: rar
      # zabbix release
      - deb: http://repo.zabbix.com/zabbix/3.2/{{ ansible_distribution | lower }}/pool/main/z/zabbix-release/zabbix-release_3.2-1+{{ ansible_distribution_release }}_all.deb
    - apt_keys:
      # dotdeb key 
      - url: https://www.dotdeb.org/dotdeb.gpg
    - apt_repositories:
      # contrib repo
      - repo: deb http://deb.debian.org/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} contrib
      # non-free repo
      - repo: deb http://deb.debian.org/{{ ansible_distribution | lower }} {{ ansible_distribution_release }} non-free
      # dotdeb repo
      - repo: deb http://packages.dotdeb.org {{ ansible_distribution_release }} all
      # nginx ppa repo
      - repo: ppa:nginx/stable
        codename: trusty
    - apt_upgrade: yes
  pre_tasks:
    - name: Verify Ansible version requirements.
      assert:
        that: "ansible_version.full | version_compare('2.3', '>=')"
        msg: >
          "You must update Ansible to at least version 2.3"
